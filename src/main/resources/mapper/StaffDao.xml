<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.trkj.crmproject.dao.StaffDao">
  <resultMap id="BaseResultMap" type="com.trkj.crmproject.entity.Staff">
    <id column="staff_id" jdbcType="INTEGER" property="staff_id" />
    <result column="user_id" jdbcType="INTEGER" property="user_id" />
    <result column="post_id" jdbcType="INTEGER" property="post_id" />
    <result column="induction_time" jdbcType="TIMESTAMP" property="induction_time" />
    <result column="staff_sex" jdbcType="VARCHAR" property="staff_sex" />
    <result column="staff_qq" jdbcType="VARCHAR" property="staff_qq" />
    <result column="staff_wx" jdbcType="VARCHAR" property="staff_wx" />
    <result column="staff_txdz" jdbcType="VARCHAR" property="staff_txdz" />
    <result column="deptment_id" jdbcType="INTEGER" property="deptment_id" />
    <result column="staff_name" jdbcType="VARCHAR" property="staff_name" />
    <result column="birthday" jdbcType="DATE" property="birthday" />
  </resultMap>
  <resultMap id="Staff" type="com.trkj.crmproject.entity.mybatis_plus.StaffMp">
    <id column="staff_id" jdbcType="INTEGER" property="staffId" />
    <result column="user_id" jdbcType="INTEGER" property="userId" />
    <result column="post_id" jdbcType="INTEGER" property="postId" />
    <result column="induction_time" jdbcType="TIMESTAMP" property="inductionTime" />
    <result column="staff_sex" jdbcType="VARCHAR" property="staffSex" />
    <result column="staff_qq" jdbcType="VARCHAR" property="staffQq" />
    <result column="staff_wx" jdbcType="VARCHAR" property="staffWx" />
    <result column="staff_txdz" jdbcType="VARCHAR" property="staffTxdz" />
    <result column="deptment_id" jdbcType="INTEGER" property="deptmentId" />
    <result column="staff_name" jdbcType="VARCHAR" property="staffName" />
  </resultMap>
  <sql id="Base_Column_List">
    staff.staff_id as staffId, staff.user_id as userId, staff.post_id as postId,
    staff.induction_time as inductionTime, staff.staff_sex as staffSex,
    staff.staff_qq as staffQq, staff.staff_wx as staffWx, staff.staffTxdz as staffTxdz,
    staff.deptment_id as deptmentId, staff.staff_name staffName, birthday as birthday
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from staff staff
    where staff.staff_id = #{staff_id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    delete from staff
    where staff_id = #{staff_id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" keyColumn="staff_id" keyProperty="staff_id" parameterType="com.trkj.crmproject.vo.StaffVo" useGeneratedKeys="true">
    insert into staff (user_id, post_id, induction_time,
      staff_sex, staff_qq, staff_wx,
      staff_txdz, deptment_id,staff_name,birthday)
    values (#{user_id,jdbcType=INTEGER}, #{post_id,jdbcType=INTEGER}, #{induction_time,jdbcType=TIMESTAMP},
      #{staff_sex,jdbcType=VARCHAR}, #{staff_qq,jdbcType=VARCHAR}, #{staff_wx,jdbcType=VARCHAR},
      #{staff_txdz,jdbcType=VARCHAR}, #{deptment_id,jdbcType=INTEGER},#{staff_name,jdbcType=VARCHAR},#{birthday,jdbcType=DATE})
  </insert>
  <insert id="insertSelective" keyColumn="staff_id" keyProperty="staff_id" parameterType="com.trkj.crmproject.entity.Staff" useGeneratedKeys="true">
    insert into staff
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="user_id != null">
        user_id,
      </if>
      <if test="post_id != null">
        post_id,
      </if>
      <if test="induction_time != null">
        induction_time,
      </if>
      <if test="staff_sex != null">
        staff_sex,
      </if>
      <if test="staff_qq != null">
        staff_qq,
      </if>
      <if test="staff_wx != null">
        staff_wx,
      </if>
      <if test="staff_txdz != null">
        staff_txdz,
      </if>
      <if test="deptment_id != null">
        deptment_id,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="user_id != null">
        #{user_id,jdbcType=INTEGER},
      </if>
      <if test="post_id != null">
        #{post_id,jdbcType=INTEGER},
      </if>
      <if test="induction_time != null">
        #{induction_time,jdbcType=TIMESTAMP},
      </if>
      <if test="staff_sex != null">
        #{staff_sex,jdbcType=VARCHAR},
      </if>
      <if test="staff_qq != null">
        #{staff_qq,jdbcType=VARCHAR},
      </if>
      <if test="staff_wx != null">
        #{staff_wx,jdbcType=VARCHAR},
      </if>
      <if test="staff_txdz != null">
        #{staff_txdz,jdbcType=VARCHAR},
      </if>
      <if test="deptment_id != null">
        #{deptment_id,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.trkj.crmproject.entity.Staff">
    update staff
    <set>
      <if test="user_id != null">
        user_id = #{user_id,jdbcType=INTEGER},
      </if>
      <if test="post_id != null">
        post_id = #{post_id,jdbcType=INTEGER},
      </if>
      <if test="induction_time != null">
        induction_time = #{induction_time,jdbcType=TIMESTAMP},
      </if>
      <if test="staff_sex != null">
        staff_sex = #{staff_sex,jdbcType=VARCHAR},
      </if>
      <if test="staff_qq != null">
        staff_qq = #{staff_qq,jdbcType=VARCHAR},
      </if>
      <if test="staff_wx != null">
        staff_wx = #{staff_wx,jdbcType=VARCHAR},
      </if>
      <if test="staff_txdz != null">
        staff_txdz = #{staff_txdz,jdbcType=VARCHAR},
      </if>
      <if test="deptment_id != null">
        deptment_id = #{deptment_id,jdbcType=INTEGER},
      </if>
    </set>
    where staff_id = #{staff_id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.trkj.crmproject.entity.Staff">
    update staff
    set user_id = #{user_id,jdbcType=INTEGER},
      post_id = #{post_id,jdbcType=INTEGER},
      induction_time = #{induction_time,jdbcType=TIMESTAMP},
      staff_sex = #{staff_sex,jdbcType=VARCHAR},
      staff_qq = #{staff_qq,jdbcType=VARCHAR},
      staff_wx = #{staff_wx,jdbcType=VARCHAR},
      staff_txdz = #{staff_txdz,jdbcType=VARCHAR},
      deptment_id = #{deptment_id,jdbcType=INTEGER}
    where staff_id = #{staff_id,jdbcType=INTEGER}
  </update>

  <select id="selectcgyid" resultMap="BaseResultMap">
    select staff.staff_id,staff.staff_name
    from staff
    INNER JOIN post ON  staff.post_id=post.post_id WHERE post.post_name='采购员';
  </select>

  <select id="selectStaffByNameAndId" resultMap="Staff">
    select * from staff s
    <where>
      <if test="param1!='' || param1==null || param1 !=0">
            staff_name like concat('%','${param1}','%')
      </if>
      <if test="param2!='' || param2==null">
        and staff_id like concat('%'+'${param2}'+'%')
      </if>
      <if test="param3!='' || param3 == null || param3 !=0">
        and deptment_id like concat('%' +'${param3}'+'%')
      </if>
    </where>
  </select>

  <select id="selectStaffByDeptId" resultMap="Staff">
    select * from staff s where deptment_id =#{deptid}
  </select>

  <select id="countStaff" resultType="com.trkj.crmproject.vo.StaffVo">
    select d.department_name departmentName,count(deptment_id) countNum from staff s LEFT JOIN department d ON d.department_id=s.deptment_id
    GROUP BY d.department_id
  </select>

  <select id="checkPass" resultType="com.trkj.crmproject.entity.Users">
    select * from user where user_name=#{name} and user_pass=#{pass}
  </select>

  <select id="selectsfattname" resultType="com.trkj.crmproject.vo.staffnameVo">
    select s.staff_id,s.staff_name,s.user_id
    from staff s left join user_role u on s.user_id=u.users_id
						 left join app_role p on u.role_id=p.role_id
						 left join approval v on p.app_id=v.app_id
    where p.role_id=#{roleId}
  </select>

  <select id="selectcgyname" resultType="com.trkj.crmproject.vo.cgyVo">
    select staff.staff_name,staff.staff_id
        from staff
                 INNER JOIN post ON  staff.post_id=post.post_id WHERE post.post_name='采购员' and staff.staff_id=#{staffid}
  </select>
</mapper>
